#!/bin/sh
# This file is part of pkgmaint.
# See COPYING and COPYRIGHT files for corresponding information.

findredundantdeps() {
	_deps=$(pkgman dep --all "$1") || exit 3

	# Intentional.
	# shellcheck disable=2086
	pkgman dep --all --recursive --full "$1" |
		grep -E "($(echo $_deps | tr ' ' '|'))$"
}

show_uniq() {
	tr ' ' '\n' | sort | uniq -u
}

print_help() {
	cat <<EOF
Usage: $PROGRAM [OPTION] PKGNAME
Find (un)necessary dependencies of the package.

  -u, --unique    print only unique (required) dependencies
  -v, --version   print version and exit
  -h, --help      print help and exit
EOF
}

main() {
	while [ "$1" ]; do
		case $1 in
		-u|--unique)
			SHOW_UNIQ_CMD=show_uniq
			;;
		-v|--version)
			echo "$PROGRAM (pkgmaint) @VERSION@"
			exit 0
			;;
		-h|--help)
			print_help
			exit 0
			;;
		-*)
			echo >&2 "$PROGRAM: invalid option $1"
			exit 1
			;;
		*)
			PKGNAME=$1
			;;
		esac
		shift
	done

	if [ -z "$PKGNAME" ]; then
		echo >&2 "$PROGRAM: option missing"
		exit 1
	fi

	findredundantdeps "$PKGNAME" | ${SHOW_UNIQ_CMD:-cat}
}

export LC_ALL=POSIX
readonly PROGRAM="${0##*/}"

main "$@"

# vim:cc=72:tw=70
# End of file.
